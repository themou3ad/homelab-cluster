---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: longhorn
spec:
  interval: 1h
  chart:
    spec:
      chart: longhorn
      version: 1.7.2
      sourceRef:
        kind: HelmRepository
        name: longhorn
  values:
    persistence:
      defaultClass: false
      defaultClassReplicaCount: 2
      defaultDataLocality: best-effort
      reclaimPolicy: Retain

    defaultSettings:
      # Use the mounted HDD paths
      defaultDataPath: /var/mnt/longhorn-sdb
      # Replica settings
      defaultReplicaCount: 2
      # Storage over-provisioning (allow 200%)
      storageOverProvisioningPercentage: 200
      # Storage minimal available percentage
      storageMinimalAvailablePercentage: 10
      # Node drain policy
      nodeDrainPolicy: block-for-eviction
      # Snapshot settings
      snapshotMaxCount: 10
      # Concurrent volume backup restore per node
      concurrentVolumeBackupRestorePerNodeLimit: 5

    longhornUI:
      replicas: 1

    ingress:
      enabled: false

    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        memory: 512Mi
