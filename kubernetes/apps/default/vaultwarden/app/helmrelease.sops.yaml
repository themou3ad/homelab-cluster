apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: vaultwarden
spec:
  interval: 1h
  timeout: 10m
  chart:
    spec:
      chart: vaultwarden
      version: 0.25.0
      sourceRef:
        kind: HelmRepository
        name: vaultwarden
  values:
    domain: https://passwords.gurzil.org
    # Admin token for admin panel
    adminToken:
      existingSecret: vaultwarden-admin
      existingSecretKey: token
    # Use testing image for SSO support + SSO Configuration
    image:
      tag: testing
      extraSecrets:
        - key: SSO_CLIENT_ID
          value: xDIZiRH0eN1ZjepMJeM86HLj2XSW5ytEUi2FlPs3
        - key: SSO_CLIENT_SECRET
          value: WzBFfTM3sDJwhchHmit2HK9QmuKGdHLQy7O2acBYUYnpwNq3plFNXeN1XcasMm0Ig1Dl1QrZgXzk1lOhwi9lMETVwEkH9nIAhMubucRDb58dy9Msrk9xLRUM8sNTuVQZ
      extraVars:
        - key: SSO_ENABLED
          value: "true"
        - key: SSO_AUTHORITY
          value: https://login.gurzil.org/application/o/passwords/
        - key: SSO_SIGNUPS_MATCH_EMAIL
          value: "true"
        - key: SSO_ALLOW_INSECURE_HTTP
          value: "false"
    # Signups disabled - only via SSO
    signupsAllowed: "false"
    # Data persistence on Longhorn
    data:
      name: ENC[AES256_GCM,data:e3tfRkQdV89EJJP/hkKEdw==,iv:tBHYYvYe2FhM7W8K+Wzmzr0Y62KFPcnS5MnBIpo+i3g=,tag:Pgxr9ykEj38xWZxlB41n9Q==,type:str]
      size: ENC[AES256_GCM,data:R4Dg,iv:P85YMNbp9Z4FDPVpqJpsVBr3Ivq8YlggJ3srDdsKJf0=,tag:CApg3orxMBPN+onWu1H0ew==,type:str]
      class: ENC[AES256_GCM,data:o1Oyy3V6QPIJ2gEm4cbaaT/xBQ==,iv:ocC+5dwAipI40jDoh4adwgENeoM+FfTYD3gSyBufZVk=,tag:ldf/YljSupV56FNHmW7VXg==,type:str]
      accessMode: ENC[AES256_GCM,data:sbbfQ8tfsVOj2rdMhg==,iv:n3kx44hV4FinfnohR7yXu1a/7xopLuY3T9gBxSUDKK4=,tag:dc3zRAqdy0asK68/DTZzLw==,type:str]
      keepPvc: ENC[AES256_GCM,data:TyLpKg==,iv:jTJyjVL+tWvR21mnlKMFvpAEua2j72ByfXwqr0rKvkk=,tag:iACn0bpCtQslLgPxKpMsVg==,type:bool]
    # Service
    service:
      type: ClusterIP
      port: 80
    # Resources
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    # Security context
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
    # Ingress disabled - using HTTPRoute
    ingress:
      enabled: false
sops:
  age:
    - recipient: age1rhp2xf08fczha5uhwp8xr5sw3kwka5qemhkx7qc9l0g4s7sv550q92jkgd
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAyK2lSaVRPN2xJVEU0dExr
        ME1lRUlSM3RzNVFZN092aWlTRjV6UjZlVFNFCmI0YTBKUzJkZWZtT0wySjNvSVVh
        TU5YWXVMV1pTUFp0OVozcE5BNVdFUkUKLS0tIHBOSXhEdjhJc3M1aCtnd1UvYi9x
        MTBSZVAxTk8xRDgwMm5qNWI3SVBBUUUKffIJtYar1hK1Xr0pnqN0xGITtkxVC8Ya
        SqTI8RxK5HZ+Mvgp8tRjb2GI2YliivjYvR1tvfmDHW28kBIlJzcP3A==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2026-01-12T10:52:01Z"
  mac: ENC[AES256_GCM,data:PE/jZQYkhduKvkfxZkL36OB1JRKIFus6/HHjFOUWdIeWmgFAJOcj59qLRe2McINejOwYvyy1DG540K5Mgfa8Szn/aa76F7ZdLxi0wIRY2y3GURWMkhB1bBc2hymRklOgbxefQSi4aZUfBpK46lTcHJvQogZEjoYO4ntyt2I17IU=,iv:G9ZrbpNXaI55+TvYBdlbBC3WsDb/TiYeTJD9cHeG/BI=,tag:fHifb9QddLlSqNVH/gmmyw==,type:str]
  encrypted_regex: ^(data|stringData)$
  mac_only_encrypted: true
  version: 3.11.0
