apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: vaultwarden
spec:
  interval: 1h
  timeout: 10m
  chart:
    spec:
      chart: vaultwarden
      version: 0.25.0
      sourceRef:
        kind: HelmRepository
        name: vaultwarden
  values:
    domain: https://passwords.gurzil.org
    # Admin token for admin panel
    adminToken:
      existingSecret: vaultwarden-admin
      existingSecretKey: token
    # Use testing image for SSO support + SSO Configuration
    image:
      tag: testing
      extraSecrets:
        - key: SSO_CLIENT_ID
          value: xDIZiRH0eN1ZjepMJeM86HLj2XSW5ytEUi2FlPs3
        - key: SSO_CLIENT_SECRET
          value: WzBFfTM3sDJwhchHmit2HK9QmuKGdHLQy7O2acBYUYnpwNq3plFNXeN1XcasMm0Ig1Dl1QrZgXzk1lOhwi9lMETVwEkH9nIAhMubucRDb58dy9Msrk9xLRUM8sNTuVQZ
      extraVars:
        - key: SSO_ENABLED
          value: "true"
        - key: SSO_AUTHORITY
          value: https://login.gurzil.org/application/o/passwords/
        - key: SSO_SIGNUPS_MATCH_EMAIL
          value: "true"
        - key: SSO_ALLOW_INSECURE_HTTP
          value: "false"
        - key: SSO_SCOPES
          value: openid email profile offline_access
    # Signups disabled - only via SSO
    signupsAllowed: "false"
    # Data persistence on Longhorn
    data:
      name: ENC[AES256_GCM,data:MCYNOEiGSy/K229tdpeHXA==,iv:WxtfiWEO2fl2v0r+myF+XwYi69VNT96pOmRRlQdjWP8=,tag:C9pLzb+gVBTxZcfGFHV8IQ==,type:str]
      size: ENC[AES256_GCM,data:n0PF,iv:FpYtMRbEQle1p7oMQxoKWxDoZHEMdTo4fpXtG2UgEn4=,tag:Dli7mHB8Im4hSxM3ENW1sw==,type:str]
      class: ENC[AES256_GCM,data:DZ2wCflWKL8CQFDyaV22EwJZsg==,iv:PQASGqpx64j/ALAHatDZdS5l3NLQmOywaXy7SXDy/g0=,tag:SCjRWvfD4pBcAyFBd4bITw==,type:str]
      accessMode: ENC[AES256_GCM,data:S98vf3+g3UdsCmMKUw==,iv:fsvWdUYIdumy9ryu3qJloyCW4WyiXcguuLFXQpiIzQM=,tag:QPlKxvZPBEyv7tIZ2NjX5g==,type:str]
      keepPvc: ENC[AES256_GCM,data:iMH9Jw==,iv:YUhM/7FzMcm0ZJzmUPnXYSZv52m1CTZH2jYuBXWZu3w=,tag:mDeR51PMfDY4Wj6jgO0yPw==,type:bool]
    # Service
    service:
      type: ClusterIP
      port: 80
    # Resources
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    # Security context
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
    # Ingress disabled - using HTTPRoute
    ingress:
      enabled: false
sops:
  age:
    - recipient: age1rhp2xf08fczha5uhwp8xr5sw3kwka5qemhkx7qc9l0g4s7sv550q92jkgd
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB3akVKSmFaOUtHaCtEOUg0
        OUNad0RpSGRnRWc1aTcreHlLbmZyRDdMaUFjCkxxZFVCWDBFS3p6b3IzNk9IRzdZ
        ODB5S3hvQnFWRTZZa05Lc016WU44SzAKLS0tIHc1aC81b3BOZi9FTFcvWEtjZWV0
        amFCK0VITHI3OU90RjNzR0JBQXB4U2MK70xBF8tjTP5Hwu8c+F3PS7rmc7osaNG+
        CBA4gUEptRVngLL+/7NXJm53ir6N6v1zPUcceqVp4A39h0aSxKF1dQ==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2026-01-12T12:54:05Z"
  mac: ENC[AES256_GCM,data:62KXC3abtMngzd23fz8oJrrtiHsWsaumVraoqjxPnKKu1/7J0kucar+Jy6Mb4F+lBq3WPA6I7HKh0IZ/1eIWApxJsuX0A4GPSRtTdWc6m5MTSnj2U15c9H3Ok9Y4/19s5+IZY4x4zS/H3WpSkRYnDm2p/y9DP3aV/4u5slDmJwU=,iv:XMRKwSTvRjyHSYORFdSeclFgDqAr+SHplVl4UJOoJ5k=,tag:NY4F7976+qRuOkoH8gtrWA==,type:str]
  encrypted_regex: ^(data|stringData)$
  mac_only_encrypted: true
  version: 3.11.0
